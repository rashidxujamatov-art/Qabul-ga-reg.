import React, { useState } from "react";
import {
  Wrench,
  Cpu,
  Zap,
  Car,
  Layout,
  CheckCircle,
  Clock,
  Award,
} from "lucide-react";

const TELEGRAM_BOT_TOKEN = "TOKENNI_BU_YERGA_QOYMANG";
const TELEGRAM_CHAT_ID = "CHAT_ID";

export default function App() {
  const [showModal, setShowModal] = useState(false);
  const [status, setStatus] = useState("");
  const [formData, setFormData] = useState({
    name: "",
    phone: "",
    course: "",
  });

  const sendTelegram = async (data) => {
    const message = `
YANGI ARIZA

Ism: ${data.name}
Telefon: ${data.phone}
Yo'nalish: ${data.course}
Vaqt: ${new Date().toLocaleString()}
`;

    try {
      const res = await fetch(
        `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: message,
          }),
        }
      );
      return res.ok;
    } catch {
      return false;
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setStatus("Yuborilmoqda...");

    const ok = await sendTelegram(formData);

    if (ok) {
      setStatus("Muvaffaqiyatli yuborildi");
      setTimeout(() => {
        setShowModal(false);
        setStatus("");
        setFormData({ name: "", phone: "", course: "" });
      }, 2000);
    } else {
      setStatus("Xatolik yuz berdi");
    }
  };

  const courses = [
    {
      title: "Mashinasozlik",
      icon: <Wrench />,
    },
    {
      title: "Payvandlash",
      icon: <Zap />,
    },
    {
      title: "Elektr va Elektronika",
      icon: <Cpu />,
    },
    {
      title: "Avto servis",
      icon: <Car />,
    },
    {
      title: "Grafik dizayn",
      icon: <Layout />,
    },
  ];

  return (
    <div className="min-h-screen bg-slate-950 text-white p-8">
      <h1 className="text-4xl font-bold text-center mb-6">
        Samarqand KOICA Markazi
      </h1>

      <div className="grid md:grid-cols-3 gap-6">
        {courses.map((course, i) => (
          <div
            key={i}
            className="bg-slate-800 p-6 rounded-2xl flex flex-col items-center"
          >
            <div className="mb-3">{course.icon}</div>
            <h3 className="font-bold mb-4">{course.title}</h3>

            <button
              onClick={() => {
                setFormData({ ...formData, course: course.title });
                setShowModal(true);
              }}
              className="bg-yellow-500 text-black px-6 py-2 rounded-xl"
            >
              Kursga yozilish
            </button>
          </div>
        ))}
      </div>

      {showModal && (
        <div className="fixed inset-0 bg-black/70 flex items-center justify-center">
          <div className="bg-white text-black p-8 rounded-2xl w-full max-w-md">
            <h2 className="text-xl font-bold mb-4">Ariza berish</h2>

            <form onSubmit={handleSubmit} className="space-y-4">
              <input
                required
                placeholder="Ism familiya"
                value={formData.name}
                onChange={(e) =>
                  setFormData({ ...formData, name: e.target.value })
                }
                className="w-full border p-2 rounded"
              />

              <input
                required
                placeholder="Telefon"
                value={formData.phone}
                onChange={(e) =>
                  setFormData({ ...formData, phone: e.target.value })
                }
                className="w-full border p-2 rounded"
              />

              <select
                required
                value={formData.course}
                onChange={(e) =>
                  setFormData({ ...formData, course: e.target.value })
                }
                className="w-full border p-2 rounded"
              >
                <option value="">Yo'nalishni tanlang</option>
                {courses.map((c, i) => (
                  <option key={i} value={c.title}>
                    {c.title}
                  </option>
                ))}
              </select>

              <button
                type="submit"
                className="w-full bg-blue-900 text-white py-2 rounded-xl"
              >
                {status || "Tasdiqlash"}
              </button>
            </form>

            <button
              onClick={() => setShowModal(false)}
              className="mt-4 text-sm text-gray-500"
            >
              Yopish
            </button>
          </div>
        </div>
      )}

      <div className="grid md:grid-cols-4 gap-6 mt-16 text-center">
        <div>
          <Clock />
          <p>6+2 oy</p>
        </div>
        <div>
          <Award />
          <p>Davlat sertifikati</p>
        </div>
        <div>
          <CheckCircle />
          <p>100% Ish kafolati</p>
        </div>
      </div>
    </div>
  );
}
